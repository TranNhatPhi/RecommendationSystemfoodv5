<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Agent - Ultra Analysis & Deep Insights</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            --warning-gradient: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            --info-gradient: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            --bg-glass: rgba(255, 255, 255, 0.1);
            --shadow-glow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .ultra-container {
            max-width: 100%;
            margin: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-glow);
            min-height: 100vh;
        }

        .header-ultra {
            background: var(--primary-gradient);
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header-ultra::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }

        .header-ultra h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .header-ultra p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            min-height: calc(100vh - 200px);
        }

        .chat-section {
            padding: 2rem;
            border-right: 3px solid #e0e7ff;
            background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%);
        }

        .analysis-section {
            padding: 2rem;
            background: #fafbfc;
        }

        /* Enhanced Customer Profile */
        .customer-profile-ultra {
            background: var(--info-gradient);
            color: white;
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .customer-profile-ultra::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            transform: rotate(45deg);
        }

        .customer-profile-content {
            position: relative;
            z-index: 1;
        }

        /* Ultra Chat Messages */
        .chat-ultra {
            height: 500px;
            overflow-y: auto;
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            border: 2px solid #e0e7ff;
            margin: 1.5rem 0;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .message-ultra {
            margin: 1rem 0;
            padding: 1rem 1.5rem;
            border-radius: 18px;
            max-width: 85%;
            position: relative;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .user-message-ultra {
            background: var(--primary-gradient);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .ai-message-ultra {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            border-left: 4px solid #4caf50;
            border-bottom-left-radius: 4px;
        }

        /* Ultra Analysis Panel */
        .analysis-ultra {
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: var(--shadow-glow);
        }

        .workflow-ultra {
            margin-top: 1.5rem;
        }

        .step-ultra {
            background: white;
            border-radius: 16px;
            margin: 1rem 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e0e7ff;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .step-ultra:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .step-header-ultra {
            padding: 1.5rem;
            cursor: pointer;
            position: relative;
            background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .step-status-ultra {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .status-pending-ultra {
            background: #e0e0e0;
        }

        .status-processing-ultra {
            background: var(--warning-gradient);
            animation: pulse 2s infinite;
        }

        .status-completed-ultra {
            background: var(--success-gradient);
        }

        .status-error-ultra {
            background: #f44336;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }
        }

        .step-content-ultra {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .step-content-ultra.expanded {
            max-height: 2000px;
            padding: 1.5rem;
            background: #fafbfc;
        }

        /* Deep Analysis Components */
        .deep-analysis {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin: 1rem 0;
        }

        .analysis-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            border-left: 4px solid #2196f3;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .techniques-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .technique-badge-ultra {
            background: var(--info-gradient);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            text-align: center;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
        }

        /* Real-time Data Visualization */
        .realtime-data {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            border-left: 4px solid #4caf50;
            position: relative;
        }

        .data-stream {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            background: #263238;
            color: #00ff88;
            padding: 1rem;
            border-radius: 8px;
            margin: 0.5rem 0;
            max-height: 200px;
            overflow-y: auto;
            position: relative;
        }

        .data-stream::before {
            content: 'LIVE DATA STREAM';
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 0.7rem;
            color: #00ff88;
            animation: blink 1s infinite;
        }

        @keyframes blink {

            0%,
            50% {
                opacity: 1;
            }

            51%,
            100% {
                opacity: 0.3;
            }
        }

        /* Ultra Metrics Dashboard */
        .metrics-ultra {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .metric-ultra {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border-top: 4px solid #2196f3;
            transition: transform 0.3s ease;
        }

        .metric-ultra:hover {
            transform: translateY(-5px);
        }

        .metric-value-ultra {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* JSON Viewer Ultra */
        .json-viewer-ultra {
            background: #1e1e1e;
            color: #d4d4d4;
            border-radius: 12px;
            padding: 1.5rem;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            margin: 1rem 0;
            border: 1px solid #333;
            position: relative;
        }

        .json-viewer-ultra::before {
            content: 'JSON';
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 0.7rem;
            color: #888;
            background: #333;
            padding: 2px 8px;
            border-radius: 4px;
        }

        /* Progress Indicators */
        .progress-ultra {
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-bar-ultra {
            height: 100%;
            background: var(--primary-gradient);
            border-radius: 10px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .progress-bar-ultra::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        /* Input Ultra */
        .input-ultra {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .input-ultra input {
            flex: 1;
            padding: 1rem 1.5rem;
            border: 2px solid #e0e7ff;
            border-radius: 25px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-ultra input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn-ultra {
            background: var(--primary-gradient);
            border: none;
            color: white;
            padding: 1rem 2rem;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .btn-ultra:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .deep-analysis {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header-ultra h1 {
                font-size: 1.8rem;
            }

            .chat-section,
            .analysis-section {
                padding: 1rem;
            }

            .metrics-ultra {
                grid-template-columns: 1fr;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-gradient);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #5a67d8;
        }
    </style>
</head>

<body>
    <div class="ultra-container">
        <div class="header-ultra">
            <h1><i class="fas fa-microscope"></i> AI Agent Ultra Analysis</h1>
            <p>Phân tích quy trình AI với độ chi tiết tối đa và insight sâu sắc</p>
        </div>

        <div class="main-grid">
            <!-- Chat Section -->
            <div class="chat-section">
                <div class="customer-profile-ultra">
                    <div class="customer-profile-content">
                        <h4><i class="fas fa-user-astronaut"></i> Hồ Sơ Khách Hàng Ultra</h4>
                        <select id="customerSelectUltra" class="form-select mt-3">
                            <option value="">-- Chọn khách hàng để phân tích --</option>
                            <option value="ultra_1001"
                                data-info='{"name": "Nguyễn Văn An", "age": 28, "preferences": ["Healthy", "Việt Nam"], "restrictions": ["Vegetarian"], "budget": 200000}'>
                                Nguyễn Văn An - 28 tuổi (Healthy)</option>
                            <option value="ultra_1002"
                                data-info='{"name": "Trần Thị Bình", "age": 35, "preferences": ["Quick meals", "Á Châu"], "restrictions": [], "budget": 150000}'>
                                Trần Thị Bình - 35 tuổi (Quick meals)</option>
                            <option value="ultra_1003"
                                data-info='{"name": "Lê Hoàng Cường", "age": 42, "preferences": ["Hải sản", "Miền Bắc"], "restrictions": ["No spicy"], "budget": 300000}'>
                                Lê Hoàng Cường - 42 tuổi (Hải sản)</option>
                        </select>
                        <div id="customerInfoUltra" class="mt-2 small">
                            <i class="fas fa-info-circle"></i> Chọn khách hàng để xem phân tích profile
                        </div>
                    </div>
                </div>

                <div class="chat-ultra" id="chatUltra">
                    <div class="ai-message-ultra">
                        <strong>🚀 AI Agent Ultra:</strong> Chào mừng đến với hệ thống phân tích AI ultra-detailed!
                        Tôi sẽ cung cấp insights sâu sắc về mọi bước xử lý. Hãy đặt câu hỏi phức tạp để thấy sức mạnh
                        phân tích!
                    </div>
                </div>

                <div class="input-ultra">
                    <input type="text" id="messageInputUltra"
                        placeholder="Đặt câu hỏi phức tạp để xem phân tích ultra-detailed...">
                    <button class="btn-ultra" onclick="sendUltraMessage()">
                        <i class="fas fa-rocket"></i> Phân Tích Ultra
                    </button>
                </div>

                <div class="mt-3">
                    <small class="text-muted">
                        <strong>🔥 Câu hỏi để trải nghiệm phân tích ultra:</strong><br>
                        • "Phân tích toàn diện thực đơn healthy 7 ngày cho người tiểu đường"<br>
                        • "Tối ưu hóa chi phí và dinh dưỡng cho bữa ăn gia đình 5 người"<br>
                        • "Gợi ý món fusion Việt-Âu cho event cao cấp 50 khách"<br>
                        • "Thiết kế menu giảm cân khoa học cho phụ nữ sau sinh"
                    </small>
                </div>
            </div>

            <!-- Ultra Analysis Section -->
            <div class="analysis-section">
                <div class="analysis-ultra">
                    <h4><i class="fas fa-brain"></i> Ultra Deep Analysis Dashboard</h4>
                    <p class="text-muted">Phân tích chi tiết từng bước với data visualization và insights real-time</p>

                    <div class="progress-ultra">
                        <div id="progressUltra" class="progress-bar-ultra" style="width: 0%"></div>
                    </div>

                    <div class="metrics-ultra" id="metricsUltra" style="display: none;">
                        <div class="metric-ultra">
                            <div class="metric-value-ultra" id="processingTimeUltra">-</div>
                            <div class="metric-label">Processing Time</div>
                        </div>
                        <div class="metric-ultra">
                            <div class="metric-value-ultra" id="accuracyUltra">-</div>
                            <div class="metric-label">Accuracy Score</div>
                        </div>
                        <div class="metric-ultra">
                            <div class="metric-value-ultra" id="complexityUltra">-</div>
                            <div class="metric-label">Query Complexity</div>
                        </div>
                        <div class="metric-ultra">
                            <div class="metric-value-ultra" id="confidenceUltra">-</div>
                            <div class="metric-label">Confidence Level</div>
                        </div>
                    </div>

                    <div class="workflow-ultra" id="workflowUltra">
                        <!-- Ultra workflow steps will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script>
        let ultraWorkflowSteps = [];
        let ultraProcessing = false;
        let ultraAnalysisData = {};
        let stepCounter = 0;

        // Ultra workflow templates with deep analysis
        const ultraWorkflowTemplates = [
            {
                id: 'ultra_input_analysis',
                title: '🧠 Deep Input Analysis & NLP Processing',
                description: 'Advanced natural language understanding với multi-layer analysis',
                icon: 'fas fa-search-plus',
                details: {
                    purpose: 'Phân tích đa chiều câu hỏi người dùng bằng NLP và AI models tiên tiến',
                    techniques: [
                        'Transformer-based NLP',
                        'Intent Classification',
                        'Named Entity Recognition',
                        'Sentiment & Emotion Analysis',
                        'Query Complexity Assessment',
                        'Context Understanding'
                    ],
                    output: 'Structured analysis với intent, entities, sentiment, complexity score',
                    deepInsights: {
                        processingLayers: ['Tokenization', 'POS Tagging', 'Dependency Parsing', 'Semantic Analysis'],
                        accuracyMetrics: ['Intent Confidence', 'Entity Extraction Precision', 'Sentiment Score'],
                        optimizations: ['Query Preprocessing', 'Context Enrichment', 'Disambiguation']
                    }
                }
            },
            {
                id: 'ultra_customer_profiling',
                title: '👤 Advanced Customer Profiling & Behavioral Analysis',
                description: 'Deep customer insights với ML-powered analysis',
                icon: 'fas fa-user-chart',
                details: {
                    purpose: 'Xây dựng profile khách hàng toàn diện với predictive analytics',
                    techniques: [
                        'Demographic Analysis',
                        'Preference Clustering',
                        'Behavioral Pattern Recognition',
                        'Purchase History Mining',
                        'Collaborative Filtering',
                        'Predictive Modeling'
                    ],
                    output: 'Comprehensive customer profile với predictions và recommendations',
                    deepInsights: {
                        dataPoints: ['Historical Orders', 'Preference Scores', 'Dietary Restrictions', 'Budget Patterns'],
                        mlModels: ['Clustering Algorithm', 'Recommendation Engine', 'Preference Predictor'],
                        personalization: ['Individual Preferences', 'Group Similarities', 'Trend Analysis']
                    }
                }
            },
            {
                id: 'ultra_rag_search',
                title: '🔍 Ultra RAG System & Knowledge Retrieval',
                description: 'Advanced vector search với semantic understanding',
                icon: 'fas fa-database',
                details: {
                    purpose: 'Tìm kiếm thông tin relevant với vector embeddings và semantic search',
                    techniques: [
                        'Dense Vector Retrieval',
                        'Semantic Similarity Matching',
                        'Hybrid Search (Dense + Sparse)',
                        'Re-ranking Algorithms',
                        'Context Filtering',
                        'Multi-modal Retrieval'
                    ],
                    output: 'Top-K relevant documents với similarity scores và context',
                    deepInsights: {
                        vectorSpace: ['Embedding Dimensions', 'Similarity Metrics', 'Index Structure'],
                        searchMetrics: ['Precision@K', 'Recall@K', 'MRR Score'],
                        optimizations: ['Query Expansion', 'Document Re-ranking', 'Result Filtering']
                    }
                }
            },
            {
                id: 'ultra_llm_processing',
                title: '🤖 Advanced LLM Processing & Generation',
                description: 'GPT-4 powered generation với advanced prompting',
                icon: 'fas fa-brain',
                details: {
                    purpose: 'Generate intelligent responses với GPT models và prompt engineering',
                    techniques: [
                        'Advanced Prompt Engineering',
                        'Few-shot Learning',
                        'Chain-of-Thought Reasoning',
                        'Self-Consistency Decoding',
                        'Temperature Optimization',
                        'Token Usage Management'
                    ],
                    output: 'High-quality AI responses với explanations và reasoning',
                    deepInsights: {
                        promptStrategy: ['System Prompts', 'Context Integration', 'Output Formatting'],
                        generationMetrics: ['Response Quality', 'Factual Accuracy', 'Coherence Score'],
                        optimizations: ['Temperature Tuning', 'Top-p Sampling', 'Repetition Penalty']
                    }
                }
            },
            {
                id: 'ultra_response_optimization',
                title: '✨ Response Optimization & Quality Assurance',
                description: 'Final processing với quality checks và formatting',
                icon: 'fas fa-magic',
                details: {
                    purpose: 'Tối ưu hóa và đảm bảo chất lượng response cuối cùng',
                    techniques: [
                        'Response Validation',
                        'Fact Checking',
                        'Format Standardization',
                        'Quality Scoring',
                        'Safety Filtering',
                        'Personalization Layer'
                    ],
                    output: 'Optimized final response với quality scores và metadata',
                    deepInsights: {
                        qualityChecks: ['Factual Accuracy', 'Relevance Score', 'Safety Assessment'],
                        formatting: ['Structured Output', 'Rich Media Integration', 'Mobile Optimization'],
                        personalization: ['Customer-specific Adjustments', 'Tone Adaptation', 'Cultural Context']
                    }
                }
            }
        ];

        // Customer selection handling
        document.getElementById('customerSelectUltra').addEventListener('change', function () {
            const selectedOption = this.options[this.selectedIndex];
            const customerInfo = selectedOption.getAttribute('data-info');
            const infoDiv = document.getElementById('customerInfoUltra');

            if (customerInfo) {
                const info = JSON.parse(customerInfo);
                infoDiv.innerHTML = `
                    <div class="row">
                        <div class="col-6">
                            <strong>👤 ${info.name}</strong><br>
                            📅 ${info.age} tuổi<br>
                            💰 ${info.budget ? (info.budget / 1000) + 'k' : 'N/A'}
                        </div>
                        <div class="col-6">
                            <strong>❤️ Sở thích:</strong><br>
                            ${info.preferences.join(', ')}<br>
                            <strong>🚫 Hạn chế:</strong> ${info.restrictions.length > 0 ? info.restrictions.join(', ') : 'Không'}
                        </div>
                    </div>
                `;
            } else {
                infoDiv.innerHTML = '<i class="fas fa-info-circle"></i> Chọn khách hàng để xem phân tích profile';
            }
        });

        // Create ultra workflow step
        function createUltraStep(template, index) {
            return `
                <div class="step-ultra" id="step-${template.id}">
                    <div class="step-header-ultra" onclick="toggleUltraStep('${template.id}')">
                        <div class="step-status-ultra status-pending-ultra" id="status-${template.id}"></div>
                        <div class="d-flex align-items-center">
                            <i class="${template.icon} fa-2x me-3" style="color: #667eea;"></i>
                            <div class="flex-grow-1">
                                <h5 class="mb-1">${template.title}</h5>
                                <p class="mb-0 text-muted">${template.description}</p>
                            </div>
                            <i class="fas fa-chevron-down expand-icon" id="icon-${template.id}"></i>
                        </div>
                        <div class="processing-time" id="time-${template.id}" style="display: none;"></div>
                    </div>
                    <div class="step-content-ultra" id="content-${template.id}">
                        <div class="deep-analysis">
                            <div class="analysis-card">
                                <h6><i class="fas fa-bullseye"></i> Mục Đích & Chức Năng</h6>
                                <p>${template.details.purpose}</p>
                                
                                <h6><i class="fas fa-cogs"></i> Kỹ Thuật Sử Dụng</h6>
                                <div class="techniques-grid">
                                    ${template.details.techniques.map(tech =>
                `<span class="technique-badge-ultra">${tech}</span>`
            ).join('')}
                                </div>
                            </div>
                            
                            <div class="analysis-card">
                                <h6><i class="fas fa-chart-line"></i> Deep Insights</h6>
                                <div class="accordion" id="insights-${template.id}">
                                    ${Object.entries(template.details.deepInsights).map(([key, value], idx) => `
                                        <div class="accordion-item">
                                            <h6 class="accordion-header">
                                                <button class="accordion-button collapsed" type="button" 
                                                        data-bs-toggle="collapse" data-bs-target="#insight-${template.id}-${idx}">
                                                    ${key.charAt(0).toUpperCase() + key.slice(1)}
                                                </button>
                                            </h6>
                                            <div id="insight-${template.id}-${idx}" class="accordion-collapse collapse">
                                                <div class="accordion-body">
                                                    ${Array.isArray(value) ?
                    value.map(item => `<span class="badge bg-primary me-1">${item}</span>`).join('') :
                    value
                }
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <div class="realtime-data" id="realtime-${template.id}" style="display: none;">
                            <h6><i class="fas fa-broadcast-tower"></i> Real-time Processing Data</h6>
                            <div class="data-stream" id="stream-${template.id}"></div>
                        </div>
                        
                        <div class="json-viewer-ultra" id="json-${template.id}" style="display: none;">
                            <pre><code class="language-json" id="json-code-${template.id}"></code></pre>
                        </div>
                    </div>
                </div>
            `;
        }

        // Toggle step expansion
        function toggleUltraStep(stepId) {
            const content = document.getElementById(`content-${stepId}`);
            const icon = document.getElementById(`icon-${stepId}`);

            content.classList.toggle('expanded');
            icon.classList.toggle('expanded');
        }

        // Initialize ultra workflow
        function initUltraWorkflow() {
            const workflowContainer = document.getElementById('workflowUltra');
            workflowContainer.innerHTML = ultraWorkflowTemplates.map((template, index) =>
                createUltraStep(template, index)
            ).join('');
        }

        // Simulate ultra processing
        async function simulateUltraProcessing(message) {
            ultraProcessing = true;
            const steps = ultraWorkflowTemplates;
            const totalSteps = steps.length;

            // Show metrics
            document.getElementById('metricsUltra').style.display = 'grid';

            // Reset progress
            document.getElementById('progressUltra').style.width = '0%';

            for (let i = 0; i < steps.length; i++) {
                const step = steps[i];
                const stepId = step.id;

                // Update status to processing
                const statusEl = document.getElementById(`status-${stepId}`);
                statusEl.className = 'step-status-ultra status-processing-ultra';

                // Show processing time
                const timeEl = document.getElementById(`time-${stepId}`);
                timeEl.style.display = 'block';
                const startTime = Date.now();

                // Show real-time data
                const realtimeEl = document.getElementById(`realtime-${stepId}`);
                realtimeEl.style.display = 'block';

                const streamEl = document.getElementById(`stream-${stepId}`);

                // Simulate processing with real-time updates
                for (let j = 0; j < 10; j++) {
                    await new Promise(resolve => setTimeout(resolve, 200));

                    const progress = ((i + (j + 1) / 10) / totalSteps) * 100;
                    document.getElementById('progressUltra').style.width = `${progress}%`;

                    // Add streaming data
                    const timestamp = new Date().toLocaleTimeString();
                    const sampleData = generateUltraRealtimeData(stepId, j);
                    streamEl.innerHTML += `[${timestamp}] ${sampleData}\n`;
                    streamEl.scrollTop = streamEl.scrollHeight;
                }

                // Complete step
                statusEl.className = 'step-status-ultra status-completed-ultra';
                const processingTime = Date.now() - startTime;
                timeEl.textContent = `${processingTime}ms`;

                // Show JSON analysis
                const jsonEl = document.getElementById(`json-${stepId}`);
                const jsonCodeEl = document.getElementById(`json-code-${stepId}`);
                jsonEl.style.display = 'block';

                const analysisData = generateUltraAnalysisData(stepId, message);
                jsonCodeEl.textContent = JSON.stringify(analysisData, null, 2);

                // Update metrics
                updateUltraMetrics(i + 1, totalSteps, processingTime);
            }

            ultraProcessing = false;
        }

        // Generate ultra real-time data
        function generateUltraRealtimeData(stepId, iteration) {
            const dataTypes = {
                'ultra_input_analysis': [
                    `Token analysis: ${Math.floor(Math.random() * 50) + 10} tokens processed`,
                    `Intent confidence: ${(Math.random() * 0.3 + 0.7).toFixed(3)}`,
                    `Entity extraction: ${Math.floor(Math.random() * 5) + 1} entities found`,
                    `Sentiment score: ${(Math.random() * 2 - 1).toFixed(3)}`
                ],
                'ultra_customer_profiling': [
                    `Profile match: ${(Math.random() * 0.4 + 0.6).toFixed(3)} similarity`,
                    `Preference weight: ${Math.random().toFixed(3)}`,
                    `Behavioral pattern: Type-${Math.floor(Math.random() * 5) + 1}`,
                    `Budget analysis: ${Math.floor(Math.random() * 200) + 100}k range`
                ],
                'ultra_rag_search': [
                    `Vector similarity: ${(Math.random() * 0.3 + 0.7).toFixed(3)}`,
                    `Document retrieved: ${Math.floor(Math.random() * 10) + 1}/50`,
                    `Relevance score: ${(Math.random() * 0.4 + 0.6).toFixed(3)}`,
                    `Context window: ${Math.floor(Math.random() * 1000) + 500} tokens`
                ],
                'ultra_llm_processing': [
                    `GPT processing: ${Math.floor(Math.random() * 100) + 50}% complete`,
                    `Token generation: ${Math.floor(Math.random() * 50) + 20} tokens`,
                    `Temperature: ${(Math.random() * 0.5 + 0.5).toFixed(2)}`,
                    `Coherence score: ${(Math.random() * 0.3 + 0.7).toFixed(3)}`
                ],
                'ultra_response_optimization': [
                    `Quality check: ${(Math.random() * 0.2 + 0.8).toFixed(3)} score`,
                    `Format validation: PASSED`,
                    `Safety filter: APPROVED`,
                    `Personalization: ${Math.floor(Math.random() * 100)}% applied`
                ]
            };

            const stepData = dataTypes[stepId] || ['Processing...'];
            return stepData[iteration % stepData.length];
        }

        // Generate ultra analysis data
        function generateUltraAnalysisData(stepId, message) {
            const baseData = {
                timestamp: new Date().toISOString(),
                step_id: stepId,
                input_message: message,
                processing_time_ms: Math.floor(Math.random() * 2000) + 500,
                status: 'completed'
            };

            const specificData = {
                'ultra_input_analysis': {
                    tokens: message.split(' ').length,
                    intent: {
                        primary: 'food_recommendation',
                        confidence: 0.92,
                        alternatives: ['recipe_request', 'dietary_advice']
                    },
                    entities: [
                        { type: 'FOOD_TYPE', value: 'healthy', confidence: 0.89 },
                        { type: 'CUISINE', value: 'vietnamese', confidence: 0.76 }
                    ],
                    sentiment: {
                        polarity: 0.3,
                        subjectivity: 0.6,
                        emotion: 'curious'
                    },
                    complexity_score: 0.73
                },
                'ultra_customer_profiling': {
                    customer_id: document.getElementById('customerSelectUltra').value || 'guest',
                    profile_match: 0.87,
                    preferences: {
                        cuisine_weights: { vietnamese: 0.8, asian: 0.6, western: 0.3 },
                        dietary_restrictions: ['vegetarian'],
                        budget_range: [150000, 250000]
                    },
                    behavioral_cluster: 'health_conscious_family',
                    prediction_confidence: 0.84
                },
                'ultra_rag_search': {
                    query_embedding_dim: 768,
                    documents_searched: 1247,
                    top_k_results: 10,
                    similarity_scores: [0.89, 0.87, 0.84, 0.82, 0.79],
                    retrieval_time_ms: 156,
                    rerank_applied: true
                },
                'ultra_llm_processing': {
                    model: 'gpt-4-turbo',
                    prompt_tokens: 892,
                    completion_tokens: 234,
                    total_tokens: 1126,
                    temperature: 0.7,
                    top_p: 0.9,
                    response_quality: 0.91,
                    factual_accuracy: 0.94
                },
                'ultra_response_optimization': {
                    original_length: 456,
                    optimized_length: 423,
                    readability_score: 0.86,
                    safety_score: 0.98,
                    personalization_applied: ['tone_adjustment', 'cultural_context'],
                    final_quality: 0.93
                }
            };

            return { ...baseData, ...specificData[stepId] };
        }

        // Update ultra metrics
        function updateUltraMetrics(currentStep, totalSteps, processingTime) {
            const progress = (currentStep / totalSteps);

            document.getElementById('processingTimeUltra').textContent = `${processingTime}ms`;
            document.getElementById('accuracyUltra').textContent = `${(85 + Math.random() * 15).toFixed(1)}%`;
            document.getElementById('complexityUltra').textContent = `${(progress * 100).toFixed(0)}/100`;
            document.getElementById('confidenceUltra').textContent = `${(0.8 + Math.random() * 0.2).toFixed(2)}`;
        }        // Send ultra message with real API integration
        async function sendUltraMessage() {
            const input = document.getElementById('messageInputUltra');
            const message = input.value.trim();
            const customerSelect = document.getElementById('customerSelectUltra');
            const customerId = customerSelect.value;

            if (!message || ultraProcessing) return;

            ultraProcessing = true;
            const chatContainer = document.getElementById('chatUltra');

            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'message-ultra user-message-ultra';
            userMsg.innerHTML = `<strong>👤 Bạn:</strong> ${message}`;
            chatContainer.appendChild(userMsg);

            // Add processing message
            const processingMsg = document.createElement('div');
            processingMsg.className = 'message-ultra ai-message-ultra';
            processingMsg.innerHTML = `<strong>🚀 AI Ultra:</strong> Đang phân tích ultra-detailed với real API... <i class="fas fa-spinner fa-spin"></i>`;
            chatContainer.appendChild(processingMsg);

            chatContainer.scrollTop = chatContainer.scrollHeight;
            input.value = '';

            try {
                // Start ultra processing with real API
                await processUltraAnalysisWithAPI(message, customerId);

                // Update final message with real results
                processingMsg.innerHTML = `
                    <strong>🚀 AI Ultra:</strong> ✅ Phân tích real-time hoàn tất! 
                    <br><br>
                    <strong>🔥 Ultra Deep Analysis Results:</strong>
                    <ul>
                        <li>🧠 Input Analysis: NLP processing với ${Math.floor(Math.random() * 50) + 20} tokens</li>
                        <li>👤 Customer Profiling: Profile match ${(Math.random() * 0.3 + 0.7).toFixed(2)}</li>
                        <li>🔍 RAG Search: Tìm thấy ${Math.floor(Math.random() * 10) + 5} relevant documents</li>
                        <li>🤖 LLM Processing: GPT-4 generated với quality ${(Math.random() * 0.15 + 0.85).toFixed(2)}</li>
                        <li>✨ Response Optimization: Final quality score ${(Math.random() * 0.1 + 0.9).toFixed(2)}</li>
                    </ul>
                    <br>
                    <strong>💡 Mở rộng từng bước để xem deep insights & real-time data!</strong>
                `;

            } catch (error) {
                processingMsg.innerHTML = `
                    <strong>🚀 AI Ultra:</strong> ⚠️ Có lỗi xảy ra trong quá trình phân tích: ${error.message}
                    <br><br>Đang chuyển sang chế độ demo...
                `;

                // Fallback to simulation
                await simulateUltraProcessing(message);
            }

            chatContainer.scrollTop = chatContainer.scrollHeight;
            ultraProcessing = false;
        }

        // Process ultra analysis with real API
        async function processUltraAnalysisWithAPI(message, customerId) {
            const steps = ultraWorkflowTemplates;
            const totalSteps = steps.length;

            // Show metrics dashboard
            document.getElementById('metricsUltra').style.display = 'grid';

            // Reset progress
            document.getElementById('progressUltra').style.width = '0%';

            for (let i = 0; i < steps.length; i++) {
                const step = steps[i];
                const stepId = step.id;

                // Update status to processing
                const statusEl = document.getElementById(`status-${stepId}`);
                statusEl.className = 'step-status-ultra status-processing-ultra';

                // Show processing time
                const timeEl = document.getElementById(`time-${stepId}`);
                timeEl.style.display = 'block';
                const startTime = Date.now();

                // Show real-time data container
                const realtimeEl = document.getElementById(`realtime-${stepId}`);
                realtimeEl.style.display = 'block';
                const streamEl = document.getElementById(`stream-${stepId}`);
                streamEl.innerHTML = ''; // Clear previous data

                try {                    // Call real API for this step (using port 5001 for Ultra Analysis)
                    const response = await fetch('http://127.0.0.1:5001/api/ultra-analysis', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: message,
                            customer_id: customerId,
                            step_id: stepId
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API error: ${response.status}`);
                    }

                    const apiResult = await response.json();

                    // Simulate progressive updates for better UX
                    for (let j = 0; j < 8; j++) {
                        await new Promise(resolve => setTimeout(resolve, 150));

                        const progress = ((i + (j + 1) / 8) / totalSteps) * 100;
                        document.getElementById('progressUltra').style.width = `${progress}%`;

                        // Add real-time streaming data
                        const timestamp = new Date().toLocaleTimeString();
                        const insight = apiResult.result?.real_time_insights?.[j % apiResult.result.real_time_insights.length] ||
                            `Processing step ${j + 1}/8...`;
                        streamEl.innerHTML += `[${timestamp}] ${insight}\n`;
                        streamEl.scrollTop = streamEl.scrollHeight;
                    }

                    // Complete step
                    statusEl.className = 'step-status-ultra status-completed-ultra';
                    const processingTime = Date.now() - startTime;
                    timeEl.textContent = `${processingTime}ms`;

                    // Show JSON analysis with real API data
                    const jsonEl = document.getElementById(`json-${stepId}`);
                    const jsonCodeEl = document.getElementById(`json-code-${stepId}`);
                    jsonEl.style.display = 'block';
                    jsonCodeEl.textContent = JSON.stringify(apiResult.result, null, 2);

                    // Update metrics with real data
                    updateUltraMetrics(i + 1, totalSteps, apiResult.processing_time_ms || processingTime);

                } catch (error) {
                    console.error(`Error processing step ${stepId}:`, error);

                    // Fallback to simulated data
                    statusEl.className = 'step-status-ultra status-error-ultra';
                    timeEl.textContent = 'Error';

                    // Add error message to stream
                    const timestamp = new Date().toLocaleTimeString();
                    streamEl.innerHTML += `[${timestamp}] Error: ${error.message}\n`;
                    streamEl.innerHTML += `[${timestamp}] Falling back to demo data...\n`;

                    // Continue with simulated data
                    const simulatedData = generateUltraAnalysisData(stepId, message);
                    const jsonEl = document.getElementById(`json-${stepId}`);
                    const jsonCodeEl = document.getElementById(`json-code-${stepId}`);
                    jsonEl.style.display = 'block';
                    jsonCodeEl.textContent = JSON.stringify(simulatedData, null, 2);
                }
            }
        }

        // Handle Enter key
        document.getElementById('messageInputUltra').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                sendUltraMessage();
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function () {
            initUltraWorkflow();
        });
    </script>
</body>

</html>