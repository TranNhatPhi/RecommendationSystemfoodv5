<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéâ Ch√†o M·ª´ng - H·ªá Th·ªëng G·ª£i √ù M√≥n ƒÇn</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #ff6b6b;
            --secondary-color: #4ecdc4;
            --accent-color: #45b7d1;
            --success-color: #96ceb4;
            --warning-color: #ffeaa7;
            --danger-color: #ff7675;
            --dark-color: #2d3436;
            --light-color: #f8f9fa;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .welcome-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            padding: 40px;
            margin: 20px auto;
            max-width: 1200px;
        }

        .welcome-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .welcome-header h1 {
            color: var(--dark-color);
            font-weight: bold;
            margin-bottom: 15px;
        }

        .welcome-header .subtitle {
            color: #6c757d;
            font-size: 1.2rem;
        }

        .customer-info-card {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }

        .customer-info-card h3 {
            margin-bottom: 20px;
            font-weight: bold;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .info-item i {
            width: 20px;
            text-align: center;
        }

        .recommendations-section {
            margin-top: 40px;
        }

        .section-title {
            color: var(--dark-color);
            font-weight: bold;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .recipe-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            height: 100%;
        }

        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .recipe-card-header {
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--accent-color) 100%);
            color: white;
            padding: 20px;
            position: relative;
        }

        .recipe-card-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--warning-color) 100%);
        }

        .recipe-card-body {
            padding: 20px;
        }

        .recipe-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--dark-color);
        }

        .recipe-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .stat-item i {
            color: var(--primary-color);
        }

        .rating-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.9);
            color: var(--dark-color);
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .recipe-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .tag {
            background: var(--light-color);
            color: var(--dark-color);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            border: 1px solid #dee2e6;
        }

        .tag.nutrition {
            background: var(--success-color);
            color: white;
        }

        .tag.difficulty {
            background: var(--warning-color);
            color: var(--dark-color);
        }

        .recipe-actions {
            display: flex;
            gap: 10px;
        }

        .btn-recipe {
            flex: 1;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-view {
            background: var(--accent-color);
            border: none;
            color: white;
        }

        .btn-view:hover {
            background: #3a9bc1;
            color: white;
        }

        .btn-save {
            background: var(--success-color);
            border: none;
            color: white;
        }

        .btn-save:hover {
            background: #7fb069;
            color: white;
        }

        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 8px;
            height: 20px;
            margin-bottom: 10px;
        }

        @keyframes loading {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        .next-steps {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 40px;
            border: 2px solid #dee2e6;
        }

        .next-steps h4 {
            color: var(--dark-color);
            margin-bottom: 20px;
        }

        .step-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .welcome-animation {
            animation: fadeInUp 1s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        @media (max-width: 768px) {
            .welcome-container {
                margin: 10px;
                padding: 20px;
            }

            .recipe-stats {
                grid-template-columns: 1fr;
            }

            .recipe-actions {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <!-- Confetti Animation -->
    <div class="confetti" id="confetti"></div>

    <div class="container-fluid">
        <div class="welcome-container welcome-animation">
            <!-- Welcome Header -->
            <div class="welcome-header">
                <h1><i class="fas fa-party-horn"></i> Ch√†o M·ª´ng B·∫°n Gia Nh·∫≠p C·ªông ƒê·ªìng!</h1>
                <p class="subtitle">H√†nh tr√¨nh kh√°m ph√° ·∫©m th·ª±c c√° nh√¢n h√≥a c·ªßa b·∫°n b·∫Øt ƒë·∫ßu t·ª´ ƒë√¢y</p>
            </div>

            <!-- Customer Info Card -->
            <div class="customer-info-card">
                <h3><i class="fas fa-user-circle"></i> Th√¥ng Tin C·ªßa B·∫°n</h3>
                <div class="row" id="customerInfo">
                    <div class="col-md-6">
                        <div class="loading-skeleton"></div>
                        <div class="loading-skeleton"></div>
                        <div class="loading-skeleton"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="loading-skeleton"></div>
                        <div class="loading-skeleton"></div>
                        <div class="loading-skeleton"></div>
                    </div>
                </div>
            </div> <!-- Initial Recommendations -->
            <div class="recommendations-section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 class="section-title mb-0">
                        <i class="fas fa-magic"></i>
                        G·ª£i √ù M√≥n ƒÇn ƒê·∫ßu Ti√™n D√†nh Ri√™ng Cho B·∫°n
                    </h2>
                    <button class="btn btn-outline-primary btn-sm" onclick="generateNewRecommendations()"
                        id="refreshBtn">
                        <i class="fas fa-sync-alt me-1"></i>
                        T·∫°o g·ª£i √Ω m·ªõi
                    </button>
                </div>
                <p class="text-muted mb-4">
                    D·ª±a tr√™n th√¥ng tin v√† s·ªü th√≠ch c·ªßa b·∫°n, ch√∫ng t√¥i ƒë√£ t√¨m ra nh·ªØng m√≥n ƒÉn ho√†n h·∫£o ƒë·ªÉ b·∫°n b·∫Øt ƒë·∫ßu!
                </p>

                <div class="row" id="recommendationsContainer">
                    <!-- Loading skeletons -->
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="recipe-card">
                            <div class="recipe-card-header">
                                <div class="loading-skeleton" style="height: 25px; background: rgba(255,255,255,0.3);">
                                </div>
                            </div>
                            <div class="recipe-card-body">
                                <div class="loading-skeleton"></div>
                                <div class="loading-skeleton"></div>
                                <div class="loading-skeleton"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="recipe-card">
                            <div class="recipe-card-header">
                                <div class="loading-skeleton" style="height: 25px; background: rgba(255,255,255,0.3);">
                                </div>
                            </div>
                            <div class="recipe-card-body">
                                <div class="loading-skeleton"></div>
                                <div class="loading-skeleton"></div>
                                <div class="loading-skeleton"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="recipe-card">
                            <div class="recipe-card-header">
                                <div class="loading-skeleton" style="height: 25px; background: rgba(255,255,255,0.3);">
                                </div>
                            </div>
                            <div class="recipe-card-body">
                                <div class="loading-skeleton"></div>
                                <div class="loading-skeleton"></div>
                                <div class="loading-skeleton"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Next Steps -->
            <div class="next-steps">
                <h4><i class="fas fa-route"></i> B∆∞·ªõc Ti·∫øp Theo</h4>
                <div class="step-item">
                    <div class="step-number">1</div>
                    <div>
                        <strong>Kh√°m ph√° th√™m m√≥n ƒÉn</strong>
                        <p class="mb-0 text-muted">Duy·ªát qua h√†ng trƒÉm c√¥ng th·ª©c n·∫•u ƒÉn ƒë∆∞·ª£c c√° nh√¢n h√≥a cho b·∫°n</p>
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-number">2</div>
                    <div>
                        <strong>ƒê√°nh gi√° v√† ph·∫£n h·ªìi</strong>
                        <p class="mb-0 text-muted">ƒê√°nh gi√° nh·ªØng m√≥n b·∫°n ƒë√£ th·ª≠ ƒë·ªÉ h·ªá th·ªëng hi·ªÉu b·∫°n h∆°n</p>
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-number">3</div>
                    <div>
                        <strong>Nh·∫≠n g·ª£i √Ω ng√†y c√†ng ch√≠nh x√°c</strong>
                        <p class="mb-0 text-muted">C√†ng s·ª≠ d·ª•ng nhi·ªÅu, g·ª£i √Ω c√†ng ph√π h·ª£p v·ªõi kh·∫©u v·ªã c·ªßa b·∫°n</p>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <a href="/" class="btn btn-primary btn-lg me-3">
                        <i class="fas fa-home"></i> V·ªÅ Trang Ch·ªß
                    </a>
                    <a href="/recommendations" class="btn btn-outline-primary btn-lg">
                        <i class="fas fa-search"></i> Kh√°m Ph√° Ngay
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript -->
    <script>
        // Get customer ID from URL
        const customerId = window.location.pathname.split('/').pop();

        // Initialize page
        document.addEventListener('DOMContentLoaded', function () {
            loadCustomerInfo();
            createConfetti();

            // Auto-hide confetti after 5 seconds
            setTimeout(() => {
                document.getElementById('confetti').style.display = 'none';
            }, 5000);
        });

        async function loadCustomerInfo() {
            try {
                const response = await fetch(`/api/get-customer/${customerId}`);
                const result = await response.json();

                if (result.success) {
                    displayCustomerInfo(result.customer);
                    loadInitialRecommendations();
                } else {
                    console.error('Failed to load customer info:', result.error);
                    showErrorMessage('Kh√¥ng th·ªÉ t·∫£i th√¥ng tin kh√°ch h√†ng');
                }
            } catch (error) {
                console.error('Error loading customer info:', error);
                showErrorMessage('L·ªói k·∫øt n·ªëi');
            }
        }

        function displayCustomerInfo(customer) {
            const customerInfoDiv = document.getElementById('customerInfo');

            const healthGoals = customer.health_goals ? customer.health_goals.split(',') : [];
            const preferredCuisines = customer.preferred_cuisines ? customer.preferred_cuisines.split(',') : [];
            const preferredMealTimes = customer.preferred_meal_times ? customer.preferred_meal_times.split(',') : [];

            customerInfoDiv.innerHTML = `
                <div class="col-md-6">
                    <div class="info-item">
                        <i class="fas fa-user"></i>
                        <span><strong>T√™n:</strong> ${customer.full_name}</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-envelope"></i>
                        <span><strong>Email:</strong> ${customer.email}</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-birthday-cake"></i>
                        <span><strong>Tu·ªïi:</strong> ${customer.age} ‚Ä¢ <strong>Gi·ªõi t√≠nh:</strong> ${getGenderText(customer.gender)}</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-chef-hat"></i>
                        <span><strong>Tr√¨nh ƒë·ªô n·∫•u ƒÉn:</strong> ${getCookingSkillText(customer.cooking_skill_level)}</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-item">
                        <i class="fas fa-heartbeat"></i>
                        <span><strong>M·ª•c ti√™u:</strong> ${healthGoals.map(goal => getHealthGoalText(goal)).join(', ') || 'Ch∆∞a x√°c ƒë·ªãnh'}</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-utensils"></i>
                        <span><strong>M√≥n ∆∞a th√≠ch:</strong> ${preferredCuisines.map(cuisine => getCuisineText(cuisine)).join(', ') || 'ƒêa d·∫°ng'}</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-clock"></i>
                        <span><strong>B·ªØa ƒÉn quan t√¢m:</strong> ${preferredMealTimes.map(meal => getMealTimeText(meal)).join(', ') || 'T·∫•t c·∫£'}</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-money-bill-wave"></i>
                        <span><strong>Ng√¢n s√°ch:</strong> ${getBudgetText(customer.budget_range)}</span>
                    </div>
                </div>
            `;
        } async function loadInitialRecommendations() {
            try {
                // Show loading state
                document.getElementById('recommendationsContainer').innerHTML = `
                    <div class="col-12 text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">ƒêang t·∫£i...</span>
                        </div>
                        <p class="mt-2">ƒêang t·∫°o g·ª£i √Ω m√≥n ƒÉn ph√π h·ª£p cho b·∫°n...</p>
                    </div>
                `;

                // First try to get customer data to generate fresh recommendations
                const customerResponse = await fetch(`/api/get-customer/${customerId}`);
                const customerResult = await customerResponse.json();

                if (customerResult.success) {
                    // Generate fresh recommendations based on customer preferences
                    const customerData = customerResult.customer;

                    // Call the registration API to get fresh recommendations
                    const recResponse = await fetch('/api/register-customer', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            full_name: customerData.full_name,
                            email: customerData.email,
                            phone: customerData.phone,
                            age: customerData.age,
                            gender: customerData.gender,
                            health_goals: customerData.health_goals ? customerData.health_goals.split(',') : [],
                            preferred_cuisines: customerData.preferred_cuisines ? customerData.preferred_cuisines.split(',') : [],
                            preferred_meal_times: customerData.preferred_meal_times ? customerData.preferred_meal_times.split(',') : [],
                            cooking_skill_level: customerData.cooking_skill_level,
                            budget_range: customerData.budget_range,
                            generate_fresh: true,  // Flag to generate fresh recommendations
                            randomize: true        // Add randomization
                        })
                    });

                    if (recResponse.ok) {
                        const recResult = await recResponse.json();
                        if (recResult.success && recResult.recommendations) {
                            displayRecommendations(recResult.recommendations);
                        } else {
                            throw new Error('No recommendations received');
                        }
                    } else {
                        throw new Error('Failed to get recommendations');
                    }
                } else {
                    throw new Error('Failed to get customer data');
                }

            } catch (error) {
                console.error('Error loading recommendations:', error);
                showErrorMessage('Kh√¥ng th·ªÉ t·∫£i g·ª£i √Ω m√≥n ƒÉn');
            }
        }

        function displayRecommendations(recommendations) {
            const container = document.getElementById('recommendationsContainer');

            if (recommendations.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            Hi·ªán t·∫°i ch∆∞a c√≥ g·ª£i √Ω ph√π h·ª£p. Vui l√≤ng c·∫≠p nh·∫≠t th√™m th√¥ng tin s·ªü th√≠ch c·ªßa b·∫°n.
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = recommendations.map(recipe => `
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="recipe-card">
                        <div class="recipe-card-header">
                            <div class="rating-badge">
                                <i class="fas fa-star text-warning"></i> ${recipe.avg_rating}
                            </div>
                            <h5 class="mb-0">${recipe.recipe_name}</h5>
                            <small class="opacity-75">${recipe.rating_count} ƒë√°nh gi√°</small>
                        </div>
                        <div class="recipe-card-body">
                            <div class="recipe-stats">
                                <div class="stat-item">
                                    <i class="fas fa-fire"></i>
                                    <span>${recipe.estimated_calories} cal</span>
                                </div>
                                <div class="stat-item">
                                    <i class="fas fa-clock"></i>
                                    <span>${recipe.preparation_time_minutes} ph√∫t</span>
                                </div>
                                <div class="stat-item">
                                    <i class="fas fa-signal"></i>
                                    <span>${recipe.difficulty}</span>
                                </div>
                                <div class="stat-item">
                                    <i class="fas fa-money-bill"></i>
                                    <span>${formatPrice(recipe.estimated_price_vnd)}</span>
                                </div>
                            </div>
                            
                            <div class="recipe-tags">
                                <span class="tag nutrition">${getNutritionText(recipe.nutrition_category)}</span>
                                <span class="tag difficulty">${recipe.difficulty}</span>
                                <span class="tag">${getMealTimeText(recipe.meal_time)}</span>
                            </div>
                            
                            <div class="recipe-actions">
                                <button class="btn btn-recipe btn-view" onclick="viewRecipe('${recipe.recipe_url}')">
                                    <i class="fas fa-eye"></i> Xem c√¥ng th·ª©c
                                </button>
                                <button class="btn btn-recipe btn-save" onclick="saveRecipe('${recipe.recipe_name}')">
                                    <i class="fas fa-bookmark"></i> L∆∞u
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Helper functions
        function getGenderText(gender) {
            const genderMap = {
                'male': 'Nam',
                'female': 'N·ªØ',
                'other': 'Kh√°c'
            };
            return genderMap[gender] || gender;
        }

        function getCookingSkillText(skill) {
            const skillMap = {
                'beginner': 'üå± M·ªõi b·∫Øt ƒë·∫ßu',
                'intermediate': 'üë©‚Äçüç≥ Trung b√¨nh',
                'advanced': 'üë®‚Äçüç≥ Gi·ªèi',
                'expert': 'üèÜ Chuy√™n nghi·ªáp'
            };
            return skillMap[skill] || skill;
        }

        function getHealthGoalText(goal) {
            const goalMap = {
                'weight_loss': 'üèÉ‚Äç‚ôÄÔ∏è Gi·∫£m c√¢n',
                'muscle_gain': 'üí™ TƒÉng c∆°',
                'healthy_eating': 'ü•ó ƒÇn l√†nh m·∫°nh',
                'maintain_weight': '‚öñÔ∏è Duy tr√¨ c√¢n n·∫∑ng'
            };
            return goalMap[goal] || goal;
        }

        function getCuisineText(cuisine) {
            const cuisineMap = {
                'vietnamese': 'üáªüá≥ Vi·ªát Nam',
                'chinese': 'üá®üá≥ Trung Qu·ªëc',
                'japanese': 'üáØüáµ Nh·∫≠t B·∫£n',
                'korean': 'üá∞üá∑ H√†n Qu·ªëc',
                'western': 'üçù √Çu M·ªπ',
                'thai': 'üáπüá≠ Th√°i Lan'
            };
            return cuisineMap[cuisine] || cuisine;
        }

        function getMealTimeText(mealTime) {
            const mealMap = {
                'breakfast': 'üåÖ S√°ng',
                'lunch': '‚òÄÔ∏è Tr∆∞a',
                'dinner': 'üåô T·ªëi',
                'snack': 'üç™ ƒÇn v·∫∑t'
            };
            return mealMap[mealTime] || mealTime;
        }

        function getBudgetText(budget) {
            const budgetMap = {
                'low': 'üí∞ Ti·∫øt ki·ªám',
                'medium': 'üí∞üí∞ Trung b√¨nh',
                'high': 'üí∞üí∞üí∞ Cao'
            };
            return budgetMap[budget] || budget;
        }

        function getNutritionText(nutrition) {
            const nutritionMap = {
                'balanced': 'C√¢n b·∫±ng',
                'weight-loss': 'Gi·∫£m c√¢n',
                'blood-boost': 'B·ªï m√°u'
            };
            return nutritionMap[nutrition] || nutrition;
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(price).replace('‚Ç´', 'ƒë');
        }

        function viewRecipe(url) {
            if (url) {
                window.open(url, '_blank');
            }
        }

        function saveRecipe(recipeName) {
            // Implement save functionality
            alert(`ƒê√£ l∆∞u c√¥ng th·ª©c: ${recipeName}`);
        }

        function showErrorMessage(message) {
            const container = document.getElementById('recommendationsContainer');
            container.innerHTML = `
                <div class="col-12">
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-circle"></i>
                        ${message}
                    </div>
                </div>
            `;
        }

        function createConfetti() {
            const confettiContainer = document.getElementById('confetti');
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7'];

            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'absolute';
                confetti.style.width = '10px';
                confetti.style.height = '10px';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.animation = 'fall linear infinite';

                confettiContainer.appendChild(confetti);
            }

            // Add CSS for falling animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fall {
                    to {
                        transform: translateY(100vh) rotate(360deg);
                    }
                }
            `;
            document.head.appendChild(style);
        }

        async function generateNewRecommendations() {
            const refreshBtn = document.getElementById('refreshBtn');
            const originalText = refreshBtn.innerHTML;

            // Show loading state
            refreshBtn.disabled = true;
            refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>ƒêang t·∫°o...';

            try {
                await loadInitialRecommendations();

                // Show success message
                refreshBtn.innerHTML = '<i class="fas fa-check me-1"></i>ƒê√£ c·∫≠p nh·∫≠t!';
                setTimeout(() => {
                    refreshBtn.innerHTML = originalText;
                    refreshBtn.disabled = false;
                }, 2000);

            } catch (error) {
                console.error('Error generating new recommendations:', error);
                refreshBtn.innerHTML = '<i class="fas fa-exclamation-triangle me-1"></i>L·ªói';
                setTimeout(() => {
                    refreshBtn.innerHTML = originalText;
                    refreshBtn.disabled = false;
                }, 3000);
            }
        }
    </script>
</body>

</html>